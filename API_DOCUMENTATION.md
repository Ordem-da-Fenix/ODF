# üìä API - Ordem da Fenix - Documenta√ß√£o de Rotas

## üîß Informa√ß√µes Gerais
- **Base URL**: `http://localhost:8000` (desenvolvimento)
- **Timezone**: Brasil (UTC-3)
- **Formato de dados**: JSON
- **Autentica√ß√£o**: N√£o requerida (desenvolvimento)
- **Sistema de Alertas**: 5 n√≠veis integrados aos compressores
- **Monitoramento**: Tempo real com alertas autom√°ticos

---

## üì° **SENSORES** - Coleta de Dados

### üì§ **POST /sensor**
Recebe e armazena dados coletados pelos sensores dos compressores.

**Endpoint**: `POST /sensor`

**Body (JSON)**:
```json
{
  "id_compressor": 1001,
  "ligado": true,
  "pressao": 8.5,
  "temp_equipamento": 77.0,
  "temp_ambiente": 20.0,
  "potencia_kw": 22.0,
  "data_medicao": "2024-10-13T10:30:00-03:00"  // Opcional
}
```

**Valida√ß√µes**:
- `id_compressor`: Inteiro positivo, deve existir no sistema
- `ligado`: Boolean obrigat√≥rio
- `pressao`: Float ‚â• 0 (em bar)
- `temp_equipamento`: Float (temperatura em ¬∞C)
- `temp_ambiente`: Float (temperatura em ¬∞C)
- `potencia_kw`: Float ‚â• 0 (consumo de energia em kW)
- `data_medicao`: Opcional, preenchida automaticamente se omitida

**Funcionalidade Adicional**:
- **Sistema de Alertas**: Automaticamente avalia os dados e atualiza os alertas do compressor
- **5 N√≠veis**: muito_baixo üîµ, baixo üü°, normal üü¢, alto üü†, critico üî¥
- **4 Par√¢metros**: press√£o, temperatura_equipamento, temperatura_ambiente, potencia
- **Compressores M√©dios**: Baseado em especifica√ß√µes industriais (15-37 kW)
- **Integra√ß√£o**: Alertas s√£o salvos nas informa√ß√µes do compressor, n√£o nos dados do sensor

**Respostas**:
```json
// ‚úÖ Sucesso (200)
{
  "status": "sucesso",
  "message": "Dados do sensor salvos com sucesso",
  "firestore_id": "abc123xyz",
  "id_compressor": 1001,
  "data_medicao": "2024-10-13T10:30:00-03:00"
}

// ‚ùå Compressor n√£o existe (404)
{
  "detail": "Compressor com ID 1001 n√£o encontrado. Cadastre o compressor primeiro."
}

// ‚ùå Dados inv√°lidos (422)
{
  "detail": [
    {
      "loc": ["body", "pressao"],
      "msg": "ensure this value is greater than or equal to 0",
      "type": "value_error.number.not_ge"
    }
  ]
}
```

---

### üì• **GET /dados**
Lista todos os dados de sensores coletados.

**Endpoint**: `GET /dados`

**Resposta**:
```json
{
  "total": 150,
  "dados": [
    {
      "firestore_id": "abc123xyz",
      "id_compressor": 1001,
      "ligado": true,
      "pressao": 8.5,
      "temp_equipamento": 65.2,
      "temp_ambiente": 23.8,
      "data_medicao": "2024-10-13T10:30:00-03:00"
    }
    // ... mais registros
  ]
}
```

---

### üìä **GET /dados/{id_compressor}**
Busca dados de sensores de um compressor espec√≠fico.

**Endpoint**: `GET /dados/{id_compressor}`

**Par√¢metros**:
- `id_compressor` (path): ID inteiro do compressor
- `limit` (query): N√∫mero m√°ximo de registros (1-1000, padr√£o: 50)

**Exemplo**: `GET /dados/1001?limit=100`

**Resposta**:
```json
{
  "id_compressor": 1001,
  "total": 25,
  "dados": [
    {
      "firestore_id": "abc123xyz",
      "id_compressor": 1001,
      "ligado": true,
      "pressao": 8.5,
      "temp_equipamento": 65.2,
      "temp_ambiente": 23.8,
      "data_medicao": "2024-10-13T10:30:00-03:00"
    }
    // ... ordenados por data (mais recente primeiro)
  ]
}
```

---

## üè≠ **COMPRESSORES** - Gest√£o de Equipamentos

### üì§ **POST /compressores/**
Cadastra um novo compressor no sistema.

**Endpoint**: `POST /compressores/`

**Body (JSON)**:
```json
{
  "id_compressor": 1001,
  "nome_marca": "Atlas Copco GA22",
  "localizacao": "Setor A - Galp√£o 1",
  "potencia_nominal_kw": 22.0,
  "configuracao": "Compressor M√©dio-Padr√£o",
  "data_ultima_manutencao": "2024-09-15T10:00:00-03:00",  // Opcional
  "esta_ligado": false  // Padr√£o: false
}
```

**Valida√ß√µes**:
- `id_compressor`: Inteiro positivo √∫nico
- `nome_marca`: String 1-100 caracteres
- `localizacao`: String 1-200 caracteres
- `potencia_nominal_kw`: Float 15-37 kW (faixa m√©dia)
- `configuracao`: String (padr√£o: "Compressor M√©dio-Padr√£o")
- `data_ultima_manutencao`: Opcional
- `esta_ligado`: Boolean (padr√£o: false)

**Respostas**:
```json
// ‚úÖ Sucesso (200)
{
  "status": "sucesso",
  "message": "Compressor cadastrado com sucesso",
  "firestore_id": "def456abc",
  "id_compressor": 1001,
  "data_cadastro": "2024-10-13T10:30:00-03:00"
}

// ‚ùå ID j√° existe (400)
{
  "detail": "J√° existe um compressor com ID '1001'"
}
```

---

### üì• **GET /compressores/**
Lista todos os compressores cadastrados.

**Endpoint**: `GET /compressores/`

**Par√¢metros (Query)**:
- `ativo_apenas`: Boolean (true/false) - Filtrar apenas ligados/desligados
- `limit`: Inteiro 1-1000 (padr√£o: 50) - N√∫mero m√°ximo de registros

**Exemplos**:
- `GET /compressores/` - Todos os compressores
- `GET /compressores/?ativo_apenas=true` - Apenas ligados
- `GET /compressores/?ativo_apenas=false&limit=10` - Apenas desligados, m√°ximo 10

**üí° Nota para Frontend**: O sistema frontend implementa filtros avan√ßados adicionais:
- **Status**: Online/Offline (usa campo `esta_ligado`)
- **Fabricante**: Extra√≠do de `nome_marca` (Atlas Copco, Schulz, Kaeser, etc.)
- **Setor**: Extra√≠do de `localizacao` (Setor A, B, C, etc.)
- **Pot√™ncia**: Filtro por kW m√≠nimo (extra√≠do de `nome_marca` ou `potencia_nominal_kw`)
- **Alertas**: Filtra por presen√ßa de alertas (campo `alertas`)

**Resposta**:
```json
{
  "total": 5,
  "compressores": [
    {
      "firestore_id": "def456abc",
      "id_compressor": 1001,
      "nome_marca": "Atlas Copco GA55",
      "localizacao": "Setor A - Galp√£o 1",
      "data_ultima_manutencao": "2024-09-15T10:00:00-03:00",
      "esta_ligado": true,
      "data_cadastro": "2024-10-13T10:30:00-03:00",
      "data_ultima_atualizacao": "2024-10-13T15:45:00-03:00",  // Se foi atualizado
      "alertas": {
        "pressao": "normal",
        "temperatura_equipamento": "alto",
        "temperatura_ambiente": "baixo",
        "potencia": "normal"
      },
      "ultima_atualizacao_alertas": "2024-10-13T17:45:30-03:00"
    }
    // ... mais compressores
  ]
}
```

---

### üìä **GET /compressores/{id_compressor}**
Obt√©m informa√ß√µes detalhadas de um compressor espec√≠fico.

**Endpoint**: `GET /compressores/{id_compressor}`

**Par√¢metros**:
- `id_compressor` (path): ID inteiro do compressor

**Exemplo**: `GET /compressores/1001`

**Resposta**:
```json
{
  "compressor": {
    "firestore_id": "def456abc",
    "id_compressor": 1001,
    "nome_marca": "Atlas Copco GA55",
    "localizacao": "Setor A - Galp√£o 1",
    "data_ultima_manutencao": "2024-09-15T10:00:00-03:00",
    "esta_ligado": true,
    "data_cadastro": "2024-10-13T10:30:00-03:00",
    "alertas": {
      "pressao": "normal",
      "temperatura_equipamento": "normal",
      "temperatura_ambiente": "normal",
      "potencia": "normal"
      "temperatura_equipamento": "alto",
      "temperatura_ambiente": "baixo"
    },
    "ultima_atualizacao_alertas": "2024-10-13T17:45:30-03:00"
  }
}
```

---

### ‚úèÔ∏è **PUT /compressores/{id_compressor}**
Atualiza informa√ß√µes de um compressor existente.

**Endpoint**: `PUT /compressores/{id_compressor}`

**Body (JSON)** - Todos os campos s√£o opcionais:
```json
{
  "nome_marca": "Atlas Copco GA75",
  "localizacao": "Setor B - Galp√£o 2",
  "data_ultima_manutencao": "2024-10-01T14:00:00-03:00",
  "esta_ligado": true
}
```

**Resposta**:
```json
{
  "status": "sucesso",
  "message": "Compressor atualizado com sucesso",
  "compressor": {
    "firestore_id": "def456abc",
    "id_compressor": 1001,
    "nome_marca": "Atlas Copco GA75",  // Atualizado
    "localizacao": "Setor B - Galp√£o 2",  // Atualizado
    "data_ultima_manutencao": "2024-10-01T14:00:00-03:00",
    "esta_ligado": true,  // Atualizado
    "data_cadastro": "2024-10-13T10:30:00-03:00",
    "data_ultima_atualizacao": "2024-10-13T16:15:00-03:00"  // Autom√°tico
  }
}
```

---

### üóëÔ∏è **DELETE /compressores/{id_compressor}**
Remove um compressor do sistema.

**Endpoint**: `DELETE /compressores/{id_compressor}`

**Par√¢metros**:
- `id_compressor` (path): ID inteiro do compressor

**Exemplo**: `DELETE /compressores/1001`

**Resposta**:
```json
{
  "status": "sucesso",
  "message": "Compressor '1001' exclu√≠do com sucesso"
}
```

---

## ‚öôÔ∏è **CONFIGURA√á√ïES** - Sistema de Alertas

### üìã **GET /configuracoes/**
Obt√©m a configura√ß√£o fixa do sistema de monitoramento e alertas.

**Endpoint**: `GET /configuracoes/`

**Resposta**:
```json
{
  "status": "sucesso",
  "message": "Configura√ß√£o obtida com sucesso",
  "configuracao": {
    "limites_pressao": {
      "muito_baixo": {"min": 0.0, "max": 4.0},
      "baixo": {"min": 4.0, "max": 6.0},
      "normal": {"min": 6.0, "max": 8.0},
      "alto": {"min": 8.0, "max": 9.0},
      "critico": {"min": 9.0, "max": null}
    },
    "limites_temp_equipamento": {
      "muito_baixo": {"min": 0.0, "max": 15.0},
      "baixo": {"min": 15.0, "max": 25.0},
      "normal": {"min": 25.0, "max": 70.0},
      "alto": {"min": 70.0, "max": 85.0},
      "critico": {"min": 85.0, "max": null}
    },
    "limites_temp_ambiente": {
      "muito_baixo": {"min": 0.0, "max": 10.0},
      "baixo": {"min": 10.0, "max": 18.0},
      "normal": {"min": 18.0, "max": 28.0},
      "alto": {"min": 28.0, "max": 35.0},
      "critico": {"min": 35.0, "max": null}
    }
  },
  "niveis_alerta": {
    "muito_baixo": {"cor": "azul", "descricao": "Valor muito baixo - verificar funcionamento"},
    "baixo": {"cor": "amarelo", "descricao": "Valor baixo - monitorar opera√ß√£o"},
    "normal": {"cor": "verde", "descricao": "Opera√ß√£o dentro dos par√¢metros normais"},
    "alto": {"cor": "laranja", "descricao": "Valor alto - aten√ß√£o necess√°ria"},
    "critico": {"cor": "vermelho", "descricao": "Valor cr√≠tico - interven√ß√£o imediata"}
  }
}
```

---

### üìä **GET /configuracoes/info**
Informa√ß√µes detalhadas sobre o sistema de monitoramento.

**Endpoint**: `GET /configuracoes/info`

**Resposta**:
```json
{
  "projeto": "Monitoramento de Compressores Industriais",
  "versao": "1.0",
  "data_criacao": "2025-10-13",
  "tipo_configuracao": "Fixa - Compressor de Teste",
  "funcionalidades": {
    "monitoramento_tempo_real": "Avalia√ß√£o cont√≠nua de par√¢metros",
    "alertas_integrados": "Alertas inclu√≠dos nos dados do compressor",
    "configuracao_fixa": "Limites pr√©-definidos para teste"
  },
  "parametros_monitorados": [
    "pressao",
    "temperatura_equipamento", 
    "temperatura_ambiente",
    "potencia"
  ],
  "niveis_alerta": [
    "muito_baixo",
    "baixo", 
    "normal",
    "alto",
    "critico"
  ]
}
```

---

## üö® **SISTEMA DE ALERTAS** - Especifica√ß√£o T√©cnica

### üéØ **5 N√≠veis de Alerta**
O sistema utiliza uma escala de 5 n√≠veis com "normal" no centro:

| N√≠vel | Emoji | Cor | Descri√ß√£o | A√ß√£o Recomendada |
|-------|-------|-----|-----------|-------------------|
| **muito_baixo** | üîµ | Azul | Valores muito abaixo do ideal | Verificar funcionamento |
| **baixo** | üü° | Amarelo | Valores abaixo do normal | Monitorar opera√ß√£o |
| **normal** | üü¢ | Verde | Opera√ß√£o dentro dos par√¢metros | Nenhuma a√ß√£o necess√°ria |
| **alto** | üü† | Laranja | Valores acima do normal | Aten√ß√£o necess√°ria |
| **critico** | üî¥ | Vermelho | Valores cr√≠ticos | Interven√ß√£o imediata |

### üìê **Limites por Par√¢metro**

#### Press√£o (bar)
- üîµ **muito_baixo**: 0.0 - 5.0
- üü° **baixo**: 5.0 - 7.0
- üü¢ **normal**: 7.0 - 10.0
- üü† **alto**: 10.0 - 11.0
- üî¥ **critico**: 11.0+

#### Temperatura do Equipamento (¬∞C)
- üîµ **muito_baixo**: 0.0 - 60.0
- üü° **baixo**: 60.0 - 71.0
- üü¢ **normal**: 71.0 - 82.0
- üü† **alto**: 82.0 - 107.0
- üî¥ **critico**: 107.0+ (desligamento autom√°tico: 110¬∞C)

#### Temperatura Ambiente (¬∞C)
- üîµ **muito_baixo**: -10.0 - 0.0
- üü° **baixo**: 0.0 - 10.0
- üü¢ **normal**: 10.0 - 29.0
- üü† **alto**: 29.0 - 46.0
- üî¥ **critico**: 46.0+

#### Pot√™ncia/Consumo (kW)
- üîµ **muito_baixo**: 0.0 - 10.0
- üü° **baixo**: 10.0 - 15.0
- üü¢ **normal**: 15.0 - 37.0
- üü† **alto**: 37.0 - 45.0
- üî¥ **critico**: 45.0+

### üîÑ **Funcionamento do Sistema**
1. **Coleta**: Sensor envia dados via `POST /sensor`
2. **Avalia√ß√£o**: Sistema calcula alertas baseado nos limites
3. **Atualiza√ß√£o**: Alertas s√£o salvos nas informa√ß√µes do compressor
4. **Consulta**: Pr√≥xima consulta ao compressor retorna alertas atualizados

---

## ü©∫ **MONITORAMENTO** - Health Check

### üíì **GET /health**
Health check elaborado da aplica√ß√£o.

**Endpoint**: `GET /health`

**Resposta**:
```json
{
  "status": "healthy",
  "timestamp": "13/10/2024 10:30:00",
  "timezone": "America/Sao_Paulo (UTC-3)",
  "services": {
    "api": "online",
    "database": "online",
    "logging": "active",
    "alertas": "active"
  },
  "endpoints": {
    "compressores": "‚úÖ CRUD completo + alertas",
    "sensores": "‚úÖ Coleta de dados + avalia√ß√£o",
    "configuracoes": "‚úÖ Sistema de alertas",
    "health": "‚úÖ Monitoramento"
  },
  "version": "1.0.0"
}
```

---

### üèì **GET /ping**
Verifica√ß√£o r√°pida de conectividade.

**Endpoint**: `GET /ping`

**Resposta**:
```json
{
  "message": "pong",
  "status": "ok"
}
```

---

## üìã **C√ìDIGOS DE STATUS HTTP**

### ‚úÖ **Sucessos**
- `200` - OK (opera√ß√£o realizada com sucesso)

### ‚ùå **Erros do Cliente**
- `400` - Bad Request (dados inv√°lidos, duplicatas)
- `404` - Not Found (recurso n√£o encontrado)
- `422` - Unprocessable Entity (valida√ß√£o Pydantic falhou)

### ‚ö†Ô∏è **Erros do Servidor**
- `500` - Internal Server Error (erro interno, problemas de banco)
- `503` - Service Unavailable (banco de dados indispon√≠vel)
- `504` - Gateway Timeout (timeout nas opera√ß√µes)

---

## üéØ **EXEMPLOS DE USO PARA WEBSITE**

### üîÑ **Fluxo T√≠pico de Uso**

1. **Cadastrar Compressor**:
```javascript
POST /compressores/
{
  "id_compressor": 1001,
  "nome_marca": "Atlas Copco",
  "localizacao": "Galp√£o A",
  "esta_ligado": false
}
```

2. **Ligar Compressor** (atualizar status):
```javascript
PUT /compressores/1001
{
  "esta_ligado": true
}
```

3. **Enviar Dados do Sensor** (simula√ß√£o ou IoT):
```javascript
POST /sensor
{
  "id_compressor": 1001,
  "ligado": true,
  "pressao": 8.5,  // Ser√° avaliado: normal (7.0-10.0)
  "temp_equipamento": 77.0,  // Ser√° avaliado: normal (71.0-82.0)
  "temp_ambiente": 20.0,  // Ser√° avaliado: normal (10.0-29.0)
  "potencia_kw": 22.0  // Ser√° avaliado: normal (15.0-37.0)
}
// Sistema automaticamente atualiza alertas do compressor
```

4. **Visualizar Alertas Gerados**:
```javascript
GET /compressores/1001  // Compressor espec√≠fico COM ALERTAS
{
  "id_compressor": 1001,
  "nome_marca": "Atlas Copco GA22",
  "alertas": {
    "pressao": "normal",
    "temperatura_equipamento": "normal",
    "temperatura_ambiente": "normal",
    "potencia": "normal"
  },
  "ultima_atualizacao_alertas": "2024-01-15T10:30:00",
  // ... outros dados
}
```

5. **Buscar Dados para Dashboard**:
```javascript
GET /dados/1001?limit=100  // √öltimas 100 medi√ß√µes
GET /compressores/?ativo_apenas=true  // Compressores ativos COM alertas
GET /configuracoes/  // Configura√ß√µes de alertas
```

### üìä **Para Dashboard em Tempo Real**
- Consultar `/health` para status geral do sistema
- Consultar `/compressores/?ativo_apenas=true` para compressores ativos **COM ALERTAS**
- Consultar `/dados/{id}?limit=10` para √∫ltimas medi√ß√µes de cada compressor
- Consultar `/configuracoes/` para entender os n√≠veis de alerta
- Enviar dados via `/sensor` quando receber de dispositivos IoT (atualiza alertas automaticamente)

### üö® **Para Monitoramento de Alertas**
- **4 Par√¢metros Monitorados**: press√£o, temperatura_equipamento, temperatura_ambiente, potencia
- **Alertas Integrados**: Cada compressor possui campo `alertas` com status atual dos 4 par√¢metros
- **Atualiza√ß√£o Autom√°tica**: Alertas s√£o recalculados a cada `POST /sensor`
- **5 N√≠veis Visuais**: Use emojis/cores para interface (üîµüü°üü¢üü†üî¥)
- **Timestamp**: Campo `ultima_atualizacao_alertas` mostra quando foram atualizados
- **Limites Industriais**: Baseados em compressores m√©dios (15-37 kW) para uso industrial

### üè∑Ô∏è **Headers Recomendados**
```
Content-Type: application/json
Accept: application/json
```

---

## üöÄ **Como Testar**

### Com cURL:
```bash
# Health check
curl -X GET "http://localhost:8000/health"

# Listar compressores
curl -X GET "http://localhost:8000/compressores/"

# Criar compressor
curl -X POST "http://localhost:8000/compressores/" \
  -H "Content-Type: application/json" \
  -d '{"id_compressor": 1001, "nome_marca": "Test", "localizacao": "Test Location"}'

# Enviar dados sensor (4 par√¢metros)
curl -X POST "http://localhost:8000/sensor" \
  -H "Content-Type: application/json" \
  -d '{"id_compressor": 1001, "ligado": true, "pressao": 8.5, "temp_equipamento": 77.0, "temp_ambiente": 20.0, "potencia_kw": 22.0}'
```

### Com JavaScript (Fetch):
```javascript
// Buscar compressores ativos COM alertas
const compressores = await fetch('http://localhost:8000/compressores/?ativo_apenas=true')
  .then(res => res.json());

// Exemplo de compressor com alertas (4 par√¢metros):
compressores.compressores.forEach(comp => {
  console.log(`Compressor ${comp.id_compressor}:`);
  console.log(`- Press√£o: ${comp.alertas.pressao} ÔøΩ`);
  console.log(`- Temp. Equipamento: ${comp.alertas.temperatura_equipamento} üü¢`);
  console.log(`- Temp. Ambiente: ${comp.alertas.temperatura_ambiente} üü¢`);
  console.log(`- Pot√™ncia: ${comp.alertas.potencia} ÔøΩ`);
});

// Enviar dados do sensor (atualiza alertas automaticamente)
const response = await fetch('http://localhost:8000/sensor', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    id_compressor: 1001,
    ligado: true,
    pressao: 8.5,  // Normal (7.0-10.0)
    temp_equipamento: 77.0,  // Normal (71.0-82.0)
    temp_ambiente: 20.0,  // Normal (10.0-29.0)
    potencia_kw: 22.0  // Normal (15.0-37.0)
  })
});

// Buscar configura√ß√µes de alertas
const config = await fetch('http://localhost:8000/configuracoes/')
  .then(res => res.json());
console.log('Limites:', config.configuracao.limites_pressao);
```

### üé® **Exemplo de Interface com Alertas**:
```javascript
function renderizarAlertas(alertas) {
  const emojis = {
    'muito_baixo': 'üîµ',
    'baixo': 'üü°', 
    'normal': 'üü¢',
    'alto': 'üü†',
    'critico': 'üî¥'
  };
  
  return Object.entries(alertas).map(([param, nivel]) => 
    `${emojis[nivel]} ${param}: ${nivel}`
  ).join('\n');
}

// Usar nos dados do compressor (4 par√¢metros)
const compressor = await fetch('/compressores/1001').then(r => r.json());
console.log(renderizarAlertas(compressor.compressor.alertas));
// Output: ÔøΩ pressao: normal
//         üü¢ temperatura_equipamento: normal
//         ÔøΩ temperatura_ambiente: normal
//         üü¢ potencia: normal
```

---

---

## üÜï **NOVIDADES NA VERS√ÉO 2.0.0 - Industrial**

### ‚ú® **Sistema de Alertas Expandido - 4 Par√¢metros**
- **4 par√¢metros monitorados**: press√£o, temperatura_equipamento, temperatura_ambiente, **potencia**
- **5 n√≠veis**: muito_baixo, baixo, normal, alto, critico
- **Avalia√ß√£o autom√°tica** a cada envio de dados do sensor
- **Integra√ß√£o completa** nas informa√ß√µes dos compressores
- **Limites industriais** baseados em compressores m√©dios (15-37 kW)

### üè≠ **Especifica√ß√µes Industriais**
- **Compressores M√©dios**: Faixa 15-37 kW para uso industrial
- **Limites Reais**: Baseados em especifica√ß√µes de Atlas Copco, Schulz, Ingersoll Rand
- **Monitoramento de Pot√™ncia**: Novo par√¢metro `potencia_kw` para efici√™ncia energ√©tica
- **Configura√ß√µes Otimizadas**: Limites ajustados para ambiente industrial real

### üîÑ **Fluxo Atualizado**
1. `POST /sensor` ‚Üí Sistema calcula alertas para **4 par√¢metros** automaticamente
2. `GET /compressores/{id}` ‚Üí Retorna dados COM alertas dos 4 par√¢metros atualizados
3. `GET /configuracoes/` ‚Üí Consulta limites industriais e configura√ß√µes

### üéØ **Para Desenvolvedores**
- Campo `alertas` com **4 par√¢metros** sempre presente
- Campo `potencia_kw` obrigat√≥rio no modelo SensorData
- Campo `potencia_nominal_kw` nos compressores (15-37 kW)
- Campo `ultima_atualizacao_alertas` para controle temporal
- Emojis sugeridos para interface: üîµüü°üü¢üü†üî¥
- Sistema totalmente automatizado com par√¢metros industriais

### üñ•Ô∏è **Integra√ß√£o com Frontend OFtech**
A API est√° **100% compat√≠vel** com o sistema frontend desenvolvido:

#### ‚úÖ **M√≥dulos Integrados**
```javascript
// ApiService - Integra√ß√£o completa
const compressores = await apiService.getCompressores();
const healthCheck = await apiService.checkHealth();
const sensorData = await apiService.enviarDadosSensor(dados);

// CompressorInterfaceManager - Renderiza√ß√£o autom√°tica
interface.extrairEficiencia(compressor);  // Usa campo 'eficiencia' da API
interface.extrairTemperatura(compressor); // Usa 'temp_equipamento'
interface.extrairPressao(compressor);     // Usa 'pressao'

// Sistema de Alertas - Mapeamento direto
alertas.pressao ‚Üí üîµüü°üü¢üü†üî¥
alertas.temperatura_equipamento ‚Üí Visual status
alertas.temperatura_ambiente ‚Üí Monitoramento ambiental
alertas.potencia ‚Üí Efici√™ncia energ√©tica
```

#### üîÑ **Fluxo de Dados Autom√°tico**
1. **Health Check**: `/health` ‚Üí Detecta API dispon√≠vel
2. **Carregamento**: `/compressores/` ‚Üí Popula interface dinamicamente  
3. **Monitoramento**: `/dados/{id}` ‚Üí Atualiza√ß√µes em tempo real
4. **Fallback**: Dados mock se API indispon√≠vel

#### üìä **Compatibilidade de Campos**
| Campo API | Campo Frontend | Uso |
|-----------|---------------|-----|
| `id_compressor` | `id` | Identifica√ß√£o √∫nica |
| `nome_marca` | `nome` | Exibi√ß√£o nos cards |
| `esta_ligado` | `status` | Online/Offline |
| `localizacao` | `setor` (extra√≠do) | Filtros por setor |
| `alertas.*` | Indicadores visuais | Sistema de alertas |
| `temp_equipamento` | `temperatura` | Monitoramento |
| `pressao` | `pressao` | Dados t√©cnicos |

---

## üõ†Ô∏è **IMPLEMENTA√á√ÉO PR√ÅTICA - Dicas do Desenvolvimento**

### üìã **Checklist de Integra√ß√£o**

#### ‚úÖ **1. Health Check Autom√°tico**
```javascript
// Verifica√ß√£o inicial (implementado em app.js)
async function verificarAPI() {
  try {
    const health = await fetch('http://localhost:8000/health');
    return health.ok;
  } catch {
    return false; // Fallback para mock
  }
}
```

#### ‚úÖ **2. Carregamento Din√¢mico de Dados**
```javascript
// CompressorInterfaceManager (implementado)
const response = await apiService.getCompressores();
// Sistema extrai automaticamente:
// - Setor de localizacao: "Setor A - Linha 1" ‚Üí "Setor A"  
// - Pot√™ncia de nome_marca: "Atlas Copco GA22" ‚Üí 22 kW
// - Fabricante de nome_marca: "Atlas Copco GA22" ‚Üí "Atlas Copco"
```

#### ‚úÖ **3. Sistema de Alertas Visual**
```javascript
// Mapeamento implementado (compressor-interface.js)
const statusConfig = {
  'muito_baixo': { color: 'bg-blue-500', emoji: 'üîµ' },
  'baixo': { color: 'bg-yellow-500', emoji: 'üü°' },  
  'normal': { color: 'bg-green-500', emoji: 'üü¢' },
  'alto': { color: 'bg-orange-500', emoji: 'üü†' },
  'critico': { color: 'bg-red-500', emoji: 'üî¥' }
};
```

#### ‚úÖ **4. Filtros Inteligentes**
```javascript
// SearchFilterManager (implementado)
// Filtra por atributos data-* extra√≠dos automaticamente:
element.setAttribute('data-fabricante', this.extrairFabricante(compressor.nome_marca));
element.setAttribute('data-setor', this.extrairSetor(compressor.localizacao)); 
element.setAttribute('data-alertas', this.hasAlertas(compressor.alertas));
```

#### ‚úÖ **5. Event Delegation para Modais**
```javascript
// CompressorManager (implementado) 
// Funciona com elementos criados dinamicamente da API
document.addEventListener('click', (e) => {
  if (e.target.closest('.compressor-card')) {
    const id = e.target.closest('.compressor-card').dataset.compressorId;
    abrirModal(id);
  }
});
```

### üöÄ **Performance e Otimiza√ß√£o**

#### ‚ö° **Atualiza√ß√µes em Tempo Real**
- **Health Check**: A cada 30s (`appConfig.updateInterval.healthCheck`)
- **Dados de Compressores**: A cada 6s (`appConfig.updateInterval.statusUpdate`)  
- **Gr√°ficos**: A cada 5s (`appConfig.updateInterval.charts`)
- **Dados de Sensores**: A cada 2s (`appConfig.updateInterval.realTimeData`)

#### üìä **Gest√£o de Estado**
```javascript
// config.js - Estado centralizado (implementado)
export const appState = {
  apiStatus: { isOnline: false, lastCheck: null },
  currentMode: 'mock', // 'api' | 'hybrid' | 'mock'  
  compressores: [],
  healthCheckInterval: null
};
```

### üîß **Troubleshooting**

#### ‚ùå **Problemas Comuns e Solu√ß√µes**

1. **API n√£o conecta**: Sistema usa fallback para mock automaticamente
2. **Filtros n√£o funcionam**: Event delegation implementado para elementos din√¢micos  
3. **Modais n√£o abrem**: Event delegation no documento, n√£o nos elementos
4. **Dados n√£o aparecem**: M√©todos de extra√ß√£o com fallbacks seguros implementados
5. **CORS**: Use servidor local (python -m http.server) n√£o file://

#### üè• **Debug e Logs**
```javascript
// Logs detalhados implementados em todos os m√≥dulos
console.log('üñ•Ô∏è Inicializando CompressorInterfaceManager...');
console.log(`‚úÖ ${compressores.length} compressores carregados da API`);
console.log('üîç SearchFilter: Atualizando filtros ap√≥s mudan√ßa na interface');
console.log('üìä ChartManager: Dados atualizados em tempo real');
```

---

**üîß Desenvolvido por: Ordem da Fenix**  
**üìÖ Vers√£o: 2.0.0**  
**üïí Atualizado em: 14/10/2025**  
**üö® Sistema de Alertas: Ativo com 4 Par√¢metros**  
**üîó Frontend Integrado: Sistema h√≠brido API + Mock implementado**