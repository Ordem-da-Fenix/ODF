# üìä API - Ordem da Fenix - Documenta√ß√£o de Rotas

## üîß Informa√ß√µes Gerais
- **Base URL Produ√ß√£o**: `https://ordem-da-fenix-api.fly.dev` 
- **Base URL Desenvolvimento**: `http://localhost:8000`
- **Timezone**: Brasil (UTC-3) - America/Sao_Paulo
- **Formato de dados**: JSON
- **Autentica√ß√£o**: N√£o requerida
- **Sistema de Alertas**: 3 n√≠veis com ESP32 integrado
- **Monitoramento**: Alertas pr√©-calculados pelo ESP32 e sensor tradicional
- **CORS**: Configurado para GitHub Pages e desenvolvimento local

---

## üì° **SENSORES** - Coleta de Dados Avan√ßada

### üì§ **POST /sensor**
Recebe e armazena dados coletados pelos sensores dos compressores com **7 par√¢metros monitorados**.

**Endpoint**: `POST /sensor`

**Body (JSON)** - Todos os campos obrigat√≥rios:
```json
{
  "id_compressor": 1001,
  "ligado": true,
  "pressao": 8.5,
  "temp_equipamento": 75.0,
  "temp_ambiente": 23.0,
  "potencia_kw": 22.0,
  "umidade": 55.0,
  "vibracao": false,
  "data_medicao": "2025-10-17T10:30:00-03:00"  // Opcional
}
```

**Valida√ß√µes**:
- `id_compressor`: Inteiro positivo, deve existir no sistema
- `ligado`: Boolean obrigat√≥rio (atualiza status do compressor automaticamente)
- `pressao`: Float ‚â• 0 (press√£o em bar)
- `temp_equipamento`: Float (temperatura do equipamento em ¬∞C)
- `temp_ambiente`: Float (temperatura ambiente em ¬∞C)
- `potencia_kw`: Float ‚â• 0 (consumo de energia em kW)
- `umidade`: Float 0-100 (percentual de umidade ambiente)
- `vibracao`: Boolean (detec√ß√£o de vibra√ß√£o anormal)
- `data_medicao`: Opcional, preenchida automaticamente com timezone brasileiro

**Funcionalidades Autom√°ticas**:
- ‚úÖ **Sem Dados de Medi√ß√£o**: N√ÉO salva dados de sensores
- ‚úÖ **Apenas Alertas**: Atualiza somente os alertas no documento do compressor
- ‚úÖ **3 N√≠veis**: abaixo_do_normal ÔøΩ, normal üü¢, acima_do_normal ÔøΩ
- ‚úÖ **6 Par√¢metros**: pot√™ncia, press√£o, temperatura_ambiente, temperatura_equipamento, umidade, vibra√ß√£o
- ‚úÖ **Integra√ß√£o Completa**: Alertas aplicados diretamente ao compressor

**Respostas**:
```json
// ‚úÖ Sucesso (200)
{
  "status": "sucesso",
  "message": "Dados do sensor salvos com sucesso",
  "firestore_id": "abc123xyz",
  "id_compressor": 1001,
  "data_medicao": "2025-10-17T10:30:00-03:00"
}

// ‚ùå Compressor n√£o existe (404)
{
  "detail": "Compressor com ID 1001 n√£o encontrado. Cadastre o compressor primeiro."
}

// ‚ùå Dados inv√°lidos (422)
{
  "detail": [
    {
      "loc": ["body", "umidade"],
      "msg": "ensure this value is less than or equal to 100",
      "type": "value_error.number.not_le"
    }
  ]
}
```

---

### üì• **GET /dados**
Lista todos os dados de sensores coletados com os 7 par√¢metros.

**Endpoint**: `GET /dados`

**Resposta**:
```json
{
  "total": 150,
  "dados": [
    {
      "firestore_id": "abc123xyz",
      "id_compressor": 1001,
      "ligado": true,
      "pressao": 8.5,
      "temp_equipamento": 75.0,
      "temp_ambiente": 23.0,
      "potencia_kw": 22.0,
      "umidade": 55.0,
      "vibracao": false,
      "data_medicao": "2025-10-17T10:30:00-03:00"
    }
    // ... mais registros ordenados por data (mais recente primeiro)
  ]
}
```

---

### üìä **GET /dados/{id_compressor}**
Busca dados de sensores de um compressor espec√≠fico com todos os 7 par√¢metros.

**Endpoint**: `GET /dados/{id_compressor}`

**Par√¢metros**:
- `id_compressor` (path): ID inteiro do compressor
- `limit` (query): N√∫mero m√°ximo de registros (1-1000, padr√£o: 50)

**Exemplo**: `GET /dados/1001?limit=100`

**Resposta**:
```json
{
  "id_compressor": 1001,
  "total": 25,
  "dados": [
    {
      "firestore_id": "abc123xyz",
      "id_compressor": 1001,
      "ligado": true,
      "pressao": 8.5,
      "temp_equipamento": 75.0,
      "temp_ambiente": 23.0,
      "potencia_kw": 22.0,
      "umidade": 55.0,
      "vibracao": false,
      "data_medicao": "2025-10-17T10:30:00-03:00"
    }
    // ... ordenados por data (mais recente primeiro)
  ]
}
```

---

## ü§ñ **ESP32** - Sistema de Alertas Inteligente

### üì§ **POST /esp32/alertas**
Atualiza apenas os alertas do compressor baseado nos dados pr√©-calculados pelo ESP32.

**Endpoint**: `POST /esp32/alertas`

**Body (JSON)** - Todos os campos obrigat√≥rios:
```json
{
  "id_compressor": 1001,
  "alerta_potencia": "normal",
  "alerta_pressao": "acima_do_normal",
  "alerta_temperatura_ambiente": "normal",
  "alerta_temperatura_equipamento": "acima_do_normal",
  "alerta_umidade": "abaixo_do_normal",
  "alerta_vibracao": "normal",
  "data_medicao": "2025-10-20T10:30:00-03:00"  // Opcional
}
```

**Valida√ß√µes**:
- `id_compressor`: Inteiro positivo, deve existir no sistema
- `alerta_potencia`: Enum ("abaixo_do_normal", "normal", "acima_do_normal")
- `alerta_pressao`: Enum ("abaixo_do_normal", "normal", "acima_do_normal")
- `alerta_temperatura_ambiente`: Enum ("abaixo_do_normal", "normal", "acima_do_normal")
- `alerta_temperatura_equipamento`: Enum ("abaixo_do_normal", "normal", "acima_do_normal")
- `alerta_umidade`: Enum ("abaixo_do_normal", "normal", "acima_do_normal")
- `alerta_vibracao`: Enum ("abaixo_do_normal", "normal", "acima_do_normal")
- `data_medicao`: Opcional, preenchida automaticamente com timezone brasileiro

**Funcionalidades**:
- ‚úÖ **Atualiza√ß√£o de Alertas**: Campo `alertas` do compressor atualizado
- ‚úÖ **Data de Atualiza√ß√£o**: Campo `ultima_atualizacao_alertas` preenchido
- ‚úÖ **Sem Dados de Medi√ß√£o**: N√ÉO salva dados de sensores
- ‚úÖ **Apenas Alertas**: Atualiza somente os alertas no documento do compressor
- ‚úÖ **3 N√≠veis**: abaixo_do_normal üü¶, normal üü¢, acima_do_normal üü†
- ‚úÖ **6 Par√¢metros**: pot√™ncia, press√£o, temperatura_ambiente, temperatura_equipamento, umidade, vibra√ß√£o

**Respostas**:
```json
// ‚úÖ Sucesso (200)
{
  "id_compressor": 1001,
  "alertas_atualizados": {
    "potencia": "normal",
    "pressao": "acima_do_normal",
    "temperatura_ambiente": "normal",
    "temperatura_equipamento": "acima_do_normal",
    "umidade": "abaixo_do_normal",
    "vibracao": "normal"
  },
  "data_atualizacao": "2025-10-20T10:30:00-03:00"
}

// ‚ùå Compressor n√£o existe (404)
{
  "detail": "Compressor com ID 1001 n√£o encontrado. Cadastre o compressor primeiro."
}

// ‚ùå Dados inv√°lidos (422)
{
  "detail": [
    {
      "loc": ["body", "alerta_potencia"],
      "msg": "value is not a valid enumeration member",
      "type": "type_error.enum"
    }
  ]
}
```

---

## üè≠ **COMPRESSORES** - Gest√£o de Equipamentos

### üì§ **POST /compressores/**
Cadastra um novo compressor no sistema com status autom√°tico via sensor.

**Endpoint**: `POST /compressores/`

**Body (JSON)**:
```json
{
  "id_compressor": 1001,
  "nome_marca": "Atlas Copco GA22",
  "localizacao": "Setor A - Galp√£o 1",
  "potencia_nominal_kw": 22.0,
  "configuracao": "Compressor M√©dio-Padr√£o",
  "data_ultima_manutencao": "2025-10-15T10:00:00-03:00",  // Opcional
  "esta_ligado": false  // Padr√£o: false (atualizado automaticamente via sensor)
}
```

**Valida√ß√µes**:
- `id_compressor`: Inteiro positivo √∫nico
- `nome_marca`: String 1-100 caracteres
- `localizacao`: String 1-200 caracteres
- `potencia_nominal_kw`: Float 15-37 kW (faixa m√©dia)
- `configuracao`: String (padr√£o: "Compressor M√©dio-Padr√£o")
- `data_ultima_manutencao`: Opcional (datetime)
- `esta_ligado`: Boolean (padr√£o: false, atualizado via sensor automaticamente)

**Campos Autom√°ticos**:
- `data_cadastro`: Preenchido automaticamente
- `data_ultima_atualizacao`: Atualizado quando sensor envia dados
- `alertas`: Gerados automaticamente via sistema de 7 par√¢metros
- `ultima_atualizacao_alertas`: Timestamp da √∫ltima avalia√ß√£o

**Respostas**:
```json
// ‚úÖ Sucesso (200)
{
  "status": "sucesso",
  "message": "Compressor cadastrado com sucesso",
  "firestore_id": "def456abc",
  "id_compressor": 1001,
  "data_cadastro": "2025-10-17T10:30:00-03:00"
}

// ‚ùå ID j√° existe (400)
{
  "detail": "J√° existe um compressor com ID '1001'"
}
```

---

### üì• **GET /compressores/**
Lista todos os compressores cadastrados.

**Endpoint**: `GET /compressores/`

**Par√¢metros (Query)**:
- `ativo_apenas`: Boolean (true/false) - Filtrar apenas ligados/desligados
- `limit`: Inteiro 1-1000 (padr√£o: 50) - N√∫mero m√°ximo de registros

**Exemplos**:
- `GET /compressores/` - Todos os compressores
- `GET /compressores/?ativo_apenas=true` - Apenas ligados
- `GET /compressores/?ativo_apenas=false&limit=10` - Apenas desligados, m√°ximo 10

**Resposta**:
```json
{
  "total": 5,
  "compressores": [
    {
      "firestore_id": "def456abc",
      "id_compressor": 1001,
      "nome_marca": "Atlas Copco GA22",
      "localizacao": "Setor A - Galp√£o 1",
      "potencia_nominal_kw": 22.0,
      "configuracao": "Compressor M√©dio-Padr√£o",
      "data_ultima_manutencao": "2025-10-15T10:00:00-03:00",
      "esta_ligado": true,
      "data_cadastro": "2025-10-17T08:30:00-03:00",
      "data_ultima_atualizacao": "2025-10-17T10:30:00-03:00",  // Via sensor
      "alertas": {
        "pressao": "normal",
        "temperatura_equipamento": "normal",
        "temperatura_ambiente": "normal",
        "potencia": "normal",
        "umidade": "alto",
        "vibracao": "normal"
      },
      "ultima_atualizacao_alertas": "2025-10-17T10:30:00-03:00"
    }
    // ... mais compressores com alertas dos 7 par√¢metros
  ]
}
```

---

### üìä **GET /compressores/{id_compressor}**
Obt√©m informa√ß√µes detalhadas de um compressor espec√≠fico.

**Endpoint**: `GET /compressores/{id_compressor}`

**Par√¢metros**:
- `id_compressor` (path): ID inteiro do compressor

**Exemplo**: `GET /compressores/1001`

**Resposta**:
```json
{
  "compressor": {
    "firestore_id": "def456abc",
    "id_compressor": 1001,
    "nome_marca": "Atlas Copco GA55",
    "localizacao": "Setor A - Galp√£o 1",
    "data_ultima_manutencao": "2024-09-15T10:00:00-03:00",
    "esta_ligado": true,
    "data_cadastro": "2024-10-13T10:30:00-03:00",
    "alertas": {
      "pressao": "normal",
      "temperatura_equipamento": "alto",
      "temperatura_ambiente": "baixo"
    },
    "ultima_atualizacao_alertas": "2024-10-13T17:45:30-03:00"
  }
}
```

---

### ‚úèÔ∏è **PUT /compressores/{id_compressor}**
Atualiza informa√ß√µes de um compressor existente. O sistema automaticamente preserva os alertas e dados dos sensores associados.

**Endpoint**: `PUT /compressores/{id_compressor}`

**Body (JSON)** - Todos os campos s√£o opcionais:
```json
{
  "nome_marca": "Atlas Copco GA30",
  "localizacao": "Setor B - Galp√£o 2",
  "potencia_nominal_kw": 30.0,
  "configuracao": "Compressor Grande-Eficiente",
  "data_ultima_manutencao": "2025-11-01T14:00:00-03:00",
  "esta_ligado": true
}
```

**Resposta**:
```json
{
  "status": "sucesso",
  "message": "Compressor atualizado com sucesso",
  "compressor": {
    "firestore_id": "def456abc",
    "id_compressor": 1001,
    "nome_marca": "Atlas Copco GA30",  // Atualizado
    "localizacao": "Setor B - Galp√£o 2",  // Atualizado
    "potencia_nominal_kw": 30.0,  // Atualizado
    "configuracao": "Compressor Grande-Eficiente",  // Atualizado
    "data_ultima_manutencao": "2025-11-01T14:00:00-03:00",
    "esta_ligado": true,  // Atualizado
    "data_cadastro": "2025-10-17T10:30:00-03:00",
    "data_ultima_atualizacao": "2025-10-17T16:15:00-03:00",  // Autom√°tico
    "alertas": {
      "pressao": "normal",
      "temperatura_equipamento": "normal",
      "temperatura_ambiente": "normal",
      "potencia": "normal",
      "umidade": "normal",
      "vibracao": "normal"
    },
    "ultima_atualizacao_alertas": "2025-10-17T15:30:00-03:00"
  }
}
```

---

### üóëÔ∏è **DELETE /compressores/{id_compressor}**
Remove um compressor do sistema.

**Endpoint**: `DELETE /compressores/{id_compressor}`

**Par√¢metros**:
- `id_compressor` (path): ID inteiro do compressor

**Exemplo**: `DELETE /compressores/1001`

**Resposta**:
```json
{
  "status": "sucesso",
  "message": "Compressor '1001' exclu√≠do com sucesso"
}
```

---

## ‚öôÔ∏è **CONFIGURA√á√ïES** - Sistema de Alertas

### üìã **GET /configuracoes/**
Obt√©m a configura√ß√£o fixa do sistema de monitoramento e alertas.

**Endpoint**: `GET /configuracoes/`

**Resposta**:
```json
{
  "status": "sucesso",
  "message": "Configura√ß√£o obtida com sucesso",
  "configuracao": {
    "limites_pressao": {
      "muito_baixo": {"min": 0.0, "max": 4.0},
      "baixo": {"min": 4.0, "max": 6.0},
      "normal": {"min": 6.0, "max": 8.0},
      "alto": {"min": 8.0, "max": 9.0},
      "critico": {"min": 9.0, "max": null}
    },
    "limites_temp_equipamento": {
      "muito_baixo": {"min": 0.0, "max": 15.0},
      "baixo": {"min": 15.0, "max": 25.0},
      "normal": {"min": 25.0, "max": 70.0},
      "alto": {"min": 70.0, "max": 85.0},
      "critico": {"min": 85.0, "max": null}
    },
    "limites_temp_ambiente": {
      "muito_baixo": {"min": 0.0, "max": 10.0},
      "baixo": {"min": 10.0, "max": 18.0},
      "normal": {"min": 18.0, "max": 28.0},
      "alto": {"min": 28.0, "max": 35.0},
      "critico": {"min": 35.0, "max": null}
    }
  },
  "niveis_alerta": {
    "muito_baixo": {"cor": "azul", "descricao": "Valor muito baixo - verificar funcionamento"},
    "baixo": {"cor": "amarelo", "descricao": "Valor baixo - monitorar opera√ß√£o"},
    "normal": {"cor": "verde", "descricao": "Opera√ß√£o dentro dos par√¢metros normais"},
    "alto": {"cor": "laranja", "descricao": "Valor alto - aten√ß√£o necess√°ria"},
    "critico": {"cor": "vermelho", "descricao": "Valor cr√≠tico - interven√ß√£o imediata"}
  }
}
```

---

### üìä **GET /configuracoes/info**
Informa√ß√µes detalhadas sobre o sistema de monitoramento.

**Endpoint**: `GET /configuracoes/info`

**Resposta**:
```json
{
  "projeto": "Monitoramento de Compressores Industriais",
  "versao": "1.0",
  "data_criacao": "2025-10-13",
  "tipo_configuracao": "Fixa - Compressor de Teste",
  "funcionalidades": {
    "monitoramento_tempo_real": "Avalia√ß√£o cont√≠nua de par√¢metros",
    "alertas_integrados": "Alertas inclu√≠dos nos dados do compressor",
    "configuracao_fixa": "Limites pr√©-definidos para teste"
  },
  "parametros_monitorados": [
    "pressao",
    "temperatura_equipamento", 
    "temperatura_ambiente",
    "potencia_kw",
    "umidade",
    "vibracao",
    "ligado"
  ],
  "niveis_alerta": [
    "muito_baixo",
    "baixo", 
    "normal",
    "alto",
    "critico"
  ]
}
```

---

## üö® **SISTEMA DE ALERTAS** - Especifica√ß√£o T√©cnica

### üéØ **3 N√≠veis de Alerta Simplificados**
O sistema utiliza uma escala de 3 n√≠veis com "normal" no centro:

| N√≠vel | Emoji | Cor | Descri√ß√£o | A√ß√£o Recomendada |
|-------|-------|-----|-----------|-------------------|
| **abaixo_do_normal** | ÔøΩ | Azul | Valores abaixo do esperado | Verificar funcionamento |
| **normal** | üü¢ | Verde | Opera√ß√£o dentro dos par√¢metros | Nenhuma a√ß√£o necess√°ria |
| **acima_do_normal** | üü† | Laranja | Valores acima do esperado | Monitoramento necess√°rio |

### ü§ñ **Sistema Duplo de Alertas**

#### **Sensor Tradicional (POST /sensor)**
- **Autom√°tico**: Sistema calcula alertas baseado em valores recebidos
- **7 par√¢metros monitorados**: press√£o, temperatura_equipamento, temperatura_ambiente, potencia_kw, umidade, vibracao, ligado
- **Salva dados**: Armazena dados de medi√ß√£o + gera alertas automaticamente
- **Atualiza status**: Atualiza `esta_ligado` do compressor

#### **ESP32 (POST /esp32/alertas)**
- **Pr√©-calculado**: ESP32 envia alertas j√° calculados
- **6 par√¢metros de alerta**: pot√™ncia, press√£o, temperatura_ambiente, temperatura_equipamento, umidade, vibra√ß√£o
- **Apenas alertas**: N√ÉO salva dados de medi√ß√£o
- **Atualiza√ß√£o direta**: Atualiza somente os alertas do compressor

### üîÑ **Funcionamento do Sistema**
1. **Sensor Tradicional**: Envia dados ‚Üí Sistema calcula alertas ‚Üí Salva dados + alertas
2. **ESP32**: Calcula alertas localmente ‚Üí Envia apenas alertas ‚Üí Atualiza compressor
3. **Consulta**: `GET /compressores/{id}` retorna alertas atualizados de qualquer fonte

---

## ü©∫ **MONITORAMENTO** - Health Check

### üíì **GET /health**
Health check elaborado da aplica√ß√£o.

**Endpoint**: `GET /health`

**Resposta**:
```json
{
  "status": "healthy",
  "timestamp": "13/10/2024 10:30:00",
  "timezone": "America/Sao_Paulo (UTC-3)",
  "services": {
    "api": "online",
    "database": "online",
    "logging": "active",
    "alertas": "active"
  },
  "endpoints": {
    "compressores": "‚úÖ CRUD completo + alertas",
    "sensores": "‚úÖ Coleta de dados + avalia√ß√£o",
    "configuracoes": "‚úÖ Sistema de alertas",
    "health": "‚úÖ Monitoramento"
  },
  "version": "1.0.0"
}
```

---

### üèì **GET /ping**
Verifica√ß√£o r√°pida de conectividade.

**Endpoint**: `GET /ping`

**Resposta**:
```json
{
  "message": "pong",
  "status": "ok"
}
```

---

## üìã **C√ìDIGOS DE STATUS HTTP**

### ‚úÖ **Sucessos**
- `200` - OK (opera√ß√£o realizada com sucesso)

### ‚ùå **Erros do Cliente**
- `400` - Bad Request (dados inv√°lidos, duplicatas)
- `404` - Not Found (recurso n√£o encontrado)
- `422` - Unprocessable Entity (valida√ß√£o Pydantic falhou)

### ‚ö†Ô∏è **Erros do Servidor**
- `500` - Internal Server Error (erro interno, problemas de banco)
- `503` - Service Unavailable (banco de dados indispon√≠vel)
- `504` - Gateway Timeout (timeout nas opera√ß√µes)

---

## üéØ **EXEMPLOS DE USO PARA WEBSITE**

### üîÑ **Fluxo T√≠pico de Uso**

1. **Cadastrar Compressor**:
```javascript
POST /compressores/
{
  "id_compressor": 1001,
  "nome_marca": "Atlas Copco",
  "localizacao": "Galp√£o A",
  "esta_ligado": false
}
```

2. **Ligar Compressor** (atualizar status):
```javascript
PUT /compressores/1001
{
  "esta_ligado": true
}
```

3. **Enviar Dados do Sensor** (simula√ß√£o ou IoT):
```javascript
POST /sensor
{
  "id_compressor": 1001,
  "ligado": true,
  "pressao": 8.5,  // Ser√° avaliado: normal (7.0-10.0)
  "temp_equipamento": 77.0,  // Ser√° avaliado: normal (71.0-82.0)
  "temp_ambiente": 20.0,  // Ser√° avaliado: normal (10.0-29.0)
  "potencia_kw": 22.0  // Ser√° avaliado: normal (15.0-37.0)
}
// Sistema automaticamente atualiza alertas do compressor
```

4. **Visualizar Alertas Gerados**:
```javascript
GET /compressores/1001  // Compressor espec√≠fico COM ALERTAS
{
  "id_compressor": 1001,
  "nome_marca": "Atlas Copco GA22",
  "alertas": {
    "pressao": "normal",
    "temperatura_equipamento": "normal",
    "temperatura_ambiente": "normal",
    "potencia": "normal"
  },
  "ultima_atualizacao_alertas": "2024-01-15T10:30:00",
  // ... outros dados
}
```

5. **Buscar Dados para Dashboard**:
```javascript
GET /dados/1001?limit=100  // √öltimas 100 medi√ß√µes
GET /compressores/?ativo_apenas=true  // Compressores ativos COM alertas
GET /configuracoes/  // Configura√ß√µes de alertas
```

### üìä **Para Dashboard em Tempo Real**
- Consultar `/health` para status geral do sistema
- Consultar `/compressores/?ativo_apenas=true` para compressores ativos **COM ALERTAS**
- Consultar `/dados/{id}?limit=10` para √∫ltimas medi√ß√µes de cada compressor
- Consultar `/configuracoes/` para entender os n√≠veis de alerta
- Enviar dados via `/sensor` quando receber de dispositivos IoT (atualiza alertas automaticamente)

### üö® **Para Monitoramento de Alertas**
- **4 Par√¢metros Monitorados**: press√£o, temperatura_equipamento, temperatura_ambiente, potencia
- **Alertas Integrados**: Cada compressor possui campo `alertas` com status atual dos 4 par√¢metros
- **Atualiza√ß√£o Autom√°tica**: Alertas s√£o recalculados a cada `POST /sensor`
- **3 N√≠veis Visuais**: Use emojis/cores para interface (ÔøΩüü†)
- **Timestamp**: Campo `ultima_atualizacao_alertas` mostra quando foram atualizados
- **Sistema Duplo**: Sensor tradicional (autom√°tico) + ESP32 (pr√©-calculado)
- **Simplicidade**: 3 n√≠veis mais intuitivos para monitoramento industrial

### üè∑Ô∏è **Headers Recomendados**
```
Content-Type: application/json
Accept: application/json
```

---

## üöÄ **Como Testar**

### Com cURL:
```bash
# Health check
curl -X GET "http://localhost:8000/health"

# Listar compressores
curl -X GET "http://localhost:8000/compressores/"

# Criar compressor
curl -X POST "http://localhost:8000/compressores/" \
  -H "Content-Type: application/json" \
  -d '{"id_compressor": 1001, "nome_marca": "Test", "localizacao": "Test Location"}'

# Enviar dados sensor (7 par√¢metros)
curl -X POST "http://localhost:8000/sensor" \
  -H "Content-Type: application/json" \
  -d '{"id_compressor": 1001, "ligado": true, "pressao": 8.5, "temp_equipamento": 77.0, "temp_ambiente": 20.0, "potencia_kw": 22.0, "umidade": 45.0, "vibracao": false}'
```

### Com JavaScript (Fetch):
```javascript
// Buscar compressores ativos COM alertas
const compressores = await fetch('http://localhost:8000/compressores/?ativo_apenas=true')
  .then(res => res.json());

// Exemplo de compressor com alertas (7 par√¢metros):
compressores.compressores.forEach(comp => {
  console.log(`Compressor ${comp.id_compressor}:`);
  console.log(`- Press√£o: ${comp.alertas.pressao} üü¢`);
  console.log(`- Temp. Equipamento: ${comp.alertas.temperatura_equipamento} üü¢`);
  console.log(`- Temp. Ambiente: ${comp.alertas.temperatura_ambiente} üü¢`);
  console.log(`- Pot√™ncia: ${comp.alertas.potencia} üü¢`);
  console.log(`- Umidade: ${comp.alertas.umidade} üü°`);
  console.log(`- Vibra√ß√£o: ${comp.alertas.vibracao} üü¢`);
});

// Enviar dados do sensor (atualiza alertas automaticamente) - 7 par√¢metros
const response = await fetch('http://localhost:8000/sensor', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    id_compressor: 1001,
    ligado: true,
    pressao: 8.5,  // Normal (7.0-10.0)
    temp_equipamento: 77.0,  // Normal (71.0-82.0)
    temp_ambiente: 20.0,  // Normal (10.0-29.0)
    potencia_kw: 22.0,  // Normal (15.0-37.0)
    umidade: 45.0,  // Normal (40.0-60.0)
    vibracao: false  // Normal (false)
  })
});

// Buscar configura√ß√µes de alertas
const config = await fetch('http://localhost:8000/configuracoes/')
  .then(res => res.json());
console.log('Limites:', config.configuracao.limites_pressao);
```

### üé® **Exemplo de Interface com Alertas (3 N√≠veis)**:
```javascript
function renderizarAlertas(alertas) {
  const emojis = {
    'abaixo_do_normal': 'ÔøΩ',
    'normal': 'ÔøΩ',
    'acima_do_normal': 'ÔøΩ'
  };
  
  return Object.entries(alertas).map(([param, nivel]) => 
    `${emojis[nivel]} ${param}: ${nivel}`
  ).join('\n');
}

// Usar nos dados do compressor (6 par√¢metros)
const compressor = await fetch('/compressores/1001').then(r => r.json());
console.log(renderizarAlertas(compressor.compressor.alertas));
// Output: üü¢ pressao: normal
//         üü¢ temperatura_equipamento: normal
//         üü¢ temperatura_ambiente: normal
//         üü¢ potencia: normal
//         ÔøΩ umidade: abaixo_do_normal
//         üü¢ vibracao: normal

// Enviar alertas do ESP32 (apenas alertas, sem dados)
const responseESP32 = await fetch('http://localhost:8000/esp32/alertas', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    id_compressor: 1001,
    alerta_potencia: "normal",
    alerta_pressao: "acima_do_normal",
    alerta_temperatura_ambiente: "normal",
    alerta_temperatura_equipamento: "normal",
    alerta_umidade: "abaixo_do_normal",
    alerta_vibracao: "normal"
  })
});
```

---

---

## üÜï **NOVIDADES NA VERS√ÉO 2.0.0 - Industrial Plus**

### ‚ú® **Sistema de Alertas Expandido - 3 N√≠veis Simplificados**
- **Sistema Duplo**: Sensor tradicional (c√°lculo autom√°tico) + ESP32 (alertas pr√©-calculados)
- **3 n√≠veis**: abaixo_do_normal, normal, acima_do_normal
- **Integra√ß√£o ESP32** para alertas em tempo real calculados no dispositivo
- **Compatibilidade total** com sensores tradicionais
- **6 par√¢metros de alerta ESP32**: pot√™ncia, press√£o, temperatura_ambiente, temperatura_equipamento, umidade, vibra√ß√£o
- **7 par√¢metros sensor tradicional**: + dados de medi√ß√£o completos

### üè≠ **Especifica√ß√µes Industriais Avan√ßadas**
- **Compressores M√©dios**: Faixa 15-37 kW para uso industrial
- **Limites Reais**: Baseados em especifica√ß√µes de Atlas Copco, Schulz, Ingersoll Rand
- **Monitoramento de Pot√™ncia**: Par√¢metro `potencia_kw` para efici√™ncia energ√©tica
- **Controle Ambiental**: Par√¢metro `umidade` para condi√ß√µes do ambiente
- **Detec√ß√£o de Vibra√ß√£o**: Par√¢metro `vibracao` para manuten√ß√£o preditiva
- **Configura√ß√µes Otimizadas**: Limites ajustados para ambiente industrial real

### üîÑ **Fluxo Atualizado**
1. `POST /sensor` ‚Üí Sistema calcula alertas para **7 par√¢metros** automaticamente
2. `GET /compressores/{id}` ‚Üí Retorna dados COM alertas dos 7 par√¢metros atualizados
3. `GET /configuracoes/` ‚Üí Consulta limites industriais e configura√ß√µes
4. **Atualiza√ß√µes autom√°ticas** ‚Üí Status do compressor atualizado via dados de sensor

### üéØ **Para Desenvolvedores**
- Campo `alertas` com **4 par√¢metros** sempre presente
- Campo `potencia_kw` obrigat√≥rio no modelo SensorData
- Campo `potencia_nominal_kw` nos compressores (15-37 kW)
- Campo `ultima_atualizacao_alertas` para controle temporal
- Emojis sugeridos para interface: ÔøΩüü† (3 n√≠veis)
- Sistema totalmente automatizado com ESP32 + sensor tradicional

---

**üîß Desenvolvido por: Ordem da Fenix**  
**üìÖ Vers√£o: 2.0.0**  
**üïí Atualizado em: 20/10/2025**  
**üö® Sistema de Alertas: ESP32 + Sensor Tradicional (3 N√≠veis)**